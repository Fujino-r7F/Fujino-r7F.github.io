---
title: "Elastic Beanstalkのデプロイ方法まとめ"
date: 2021-09-25T14:54:36+09:00
description:
draft: false
hideToc: false
enableToc: true
enableTocContent: false
tocFolding: false
tocPosition: inner
tocLevels: ["h2", "h3", "h4"]
tags: 
- AWS
- DVA
series:
-
categories:
-
image:
---

## はじめに
AWS認定DVA等で良く問われる、Elastic beanstalkのデプロイ方式についてまとめてます。

## 各デプロイ方式について
* All at once
	同時にすべてのインスタンスに新しいバージョンをデプロイする。
	* 利点
		所要時間が最も短い
	* 注意点
		短時間のダウンタイムが発生する 
		古いバージョンと新しいバージョンが混在する時間がある
* Rolling
	バッチサイズの分だけインスタンスをLBからデタッチして新しいバージョンをデプロイする。 
	LBに再アタッチした後に、全てのインスタンスの更新が終わるまで繰り返す。
	* 利点
		ダウンタイムを回避できる 
	* 注意点
		All at onceに比べてデプロイ時間は長くなる 
		ダウンタイムはないが、デプロイ中インスタンスの台数が減る 
		古いバージョンと新しいバージョンが混在する時間がある
* Rolling with additional batch 
	バッチサイズの分だけインスタンスを追加作成してそのインスタンスに新しいバージョンをデプロイする。 
	デプロイが通った後に、バッチサイズの分だけLBから既存のインスタンスをデタッチして、デプロイした新規インスタンスをアタッチする。 
	その後は既存インスタンスにデプロイを繰り返す。 
	最後に一番初めに追加作成したインスタンスを落とす。
	* 利点
		ダウンタイムを回避できる 
		初めに新規インスタンスを追加作成しているため、デプロイ中でもインスタンスの台数が保たれる 
	* 注意点
		Rollingに比べてデプロイ時間が長くなる 
		古いバージョンと新しいバージョンが混在する時間がある
* Immutable 
	新しいインスタンスを1台立ち上げてデプロイする 
	ヘルスチェックが通れば、現在のインスタンス数-1の数だけ新しいインスタンスを立ち上げてデプロイする 
	全てのヘルスチェックが通った後に、既存のインスタンスを落とす 
	* 利点
		ダウンタイムを回避できる 
		デプロイが失敗した際に迅速かつ安全にロールバックできる 
	* 注意点 
		Rolling with additonal batchに比べてデプロイ時間が長くなる 
		古いバージョンと新しいバージョンが混在する時間がある 
		デプロイ中は一時的にインスタンス数が2倍になるため、料金がかかる
